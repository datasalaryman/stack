on:
  push:
    branches:
       - master

jobs:
  test_rstudio_container_run:
    name: Test RStudio container run
    runs-on: ubuntu-latest
    steps:
      - name: Checkout
        uses: actions/checkout@master
      - name: Install dependencies
        run: > 
          sudo apt-get update -y && 
          sudo apt-get install -y \ 
            ca-certificates \
            curl \
            gnupg \
            lsb-release \
            build-essential
      - name: Install docker
        run: > 
          curl -fsSL \
            https://download.docker.com/linux/ubuntu/gpg | \ 
          gpg --dearmor -o \ 
            /usr/share/keyrings/docker-archive-keyring.gpg && 
          echo \
            "deb [ \ 
              arch=$(dpkg --print-architecture) \ 
              signed-by=/usr/share/keyrings/docker-archive-keyring.gpg \
            ] \ 
            https://download.docker.com/linux/ubuntu \ 
            $(lsb_release -cs) \ 
            stable" | \ 
          tee /etc/apt/sources.list.d/docker.list > /dev/null &&
          sudo apt-get update -y &&
          sudo apt-get install -y docker-ce \
            docker-ce-cli \
            containerd.io && 
          sudo groupadd docker && 
          sudo usermod -aG docker root && 
          sudo systemctl enable docker.service &&
          sudo ystemctl enable containerd.service
      - name: Install docker-compose
        run: >
          curl -L \ 
            "https://github.com/docker/compose/releases/download/1.29.2/docker-compose-$(uname -s)-$(uname -m)" \ 
            -o /usr/local/bin/docker-compose && 
          chmod +x /usr/local/bin/docker-compose
      - name: Run docker container in actions run
        run: > 
          cd vpn &&
          make run
